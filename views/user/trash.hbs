 {{!-- <h3 class="fw-normal mb-5 logo" style="color: #4a1942;">Shipping details</h3>
                  <div class="row">
                    {{!-- <div class="col-md-6 mb-4 pb-2">
                      <div class="form-outline">
                        <input type="checkbox" id="form3Examplev1" name="address" />
                        <label class="form-label" for="form3Examplev1">Use saved address</label>
                      </div>

                    </div> --}}
                    
                  </div>

                  <Address class="mb-4 pb-2">
                    <div class="form-outline">
                      <input type="text" id="form3Examplev2" name="order_address" class="form-control form-control-lg" />
                      <label class="form-label" for="form3Examplev2">Address</label>
                    </div>
                  </Address>
                  
                  <div class="mb-4 pb-2">
                    <div class="form-outline">
                      <input type="tel" id="form3Examplev3" name="mobile" class="form-control form-control-lg" />
                      <label class="form-label" for="form3Examplev3">Mobile</label>
                    </div>
                  </div>

                  <div class="row">
                    <div class="col-md-6 mb-4 pb-2 mb-md-0 pb-md-0">

                      <div class="form-outline">
                        <input type="text" id="form3Examplev4" name="pincode" class="form-control form-control-lg" />
                        <label class="form-label" for="form3Examplev4">Pincode</label>
                      </div>

                    </div>
                  
                  </div> --}}




add address form

                  <div class="tab-pane fade" id="pills-register" role="tabpanel" aria-labelledby="tab-register">

                          <div class="mb-4 pb-2">
                            <div class="form-outline">
                              <input type="text" name="title" class="form-control form-control-lg"
                                placeholder="eg. home, office" />
                              <label class="form-label" for="form3Examplev3">Title</label>
                            </div>
                          </div>

                          <Address class="mb-4 pb-2">
                            <div class="form-outline">
                              <textarea name="address" cols="3" class="form-control form-control-lg"></textarea>
                              <label class="form-label" for="form3Examplev2">Address</label>
                            </div>
                          </Address>

                          <div class="mb-4 pb-2">
                            <div class="form-outline">
                              <input type="text" name="city" class="form-control form-control-lg" />
                              <label class="form-label" for="form3Examplev3">City</label>
                            </div>
                          </div>

                          <div class="mb-4 pb-2">
                            <div class="form-outline">
                              <input type="number" name="pincode" class="form-control form-control-lg" />
                              <label class="form-label" for="form3Examplev3">Pincode</label>
                            </div>
                          </div>

                          <div class="mb-4 pb-2">
                            <div class="form-outline">
                              <input type="tel" name="phone" class="form-control form-control-lg" />
                              <label class="form-label" for="form3Examplev3">Mobile</label>
                            </div>
                          </div>

                          <!-- Submit button -->
                          <button type="submit" class="btn btn-dark btn-block mb-3 update-address-btn">Add address</button>

                        </div>




                        use address 
                         <div class="tab-pane fade show active" id="pills-login" role="tabpanel"
                        aria-labelledby="tab-login">
                        {{#if user.addresses}}
                        <h5 class="fw-light">Choose an address</h5>
                        {{#each user.addresses}}
                        <div class="p-3 rounded-5" style="background-color: rgb(238, 234, 234);">
                          <input type="radio" name="saved_address" value="{{this.title}}">
                          <label class="fw-bold" for="address">{{this.title}}</label>
                          <p class="mb-0 ps-3">{{this.address}} {{this.pincode}}</p>
                          <p class="mb-0 ps-3">+91 {{this.phone}}</p>
                        </div>
                        {{/each}}
                        {{else}}
                        <div class="p-3 row rounded-5" style="background-color: rgb(238, 234, 234);">
                          <label class="fw-bold text-center" for="address">You haven't saved any addresses yet</label>
                        </div>
                        {{/if}}



                      </div>

{{!-- --------------------------------product details------------------------------ --}}
<head>
  <script src="/javascripts/zoomsl.min.js"></script>
</head>
<section class="pt-5">
  <div class="container">
    <div class="col-md-12 d-flex flex-wrap justify-content-center">

      <div class="col-md-6 p-5">
        <img class="img-fluid rounded-4" id="image-zoom" src="/product-images/{{productDetails._id}}.jpg"
          alt="product image" style="height: 35rem; width: 30rem;">
      </div>

      <div class="col-md-6">
        <div class="card pro-detail p-5 ">
          <div class="card-body text-end">
            <h3 class="card-title py-3 logo">{{productDetails.name}}</h3>
            <div class="stars">
              <i class="fa fa-star "></i>
              <i class="fas fa-star"></i>
              <i class="fas fa-star"></i>
              <i class="fas fa-star"></i>
              <i class="fas fa-star-half-alt"></i>
            </div>
            <h6 class="card-subtitle mb-2 text-muted py-3">Category: {{productDetails.category}}</h6>
            <p class="card-text py-2">{{productDetails.description}}</p>
            <p class="card-text py-2">Material: {{productDetails.material_type}}</p>
            {{#if productDetails.stock}}
            <p class="card-text py-1 text-success">{{productDetails.stock}} in stock</p>
            {{else}}
            <p class="card-text py-1 text-danger">Out of stock</p>
            {{/if}}
            <select name="sizes" id="">
              <option>Size</option>
              {{#each productDetails.sizes}}
              <option value="{{this}}">{{this}}</option>
              {{/each}}
            </select>
            <div class="d-flex justify-content-end">
              {{#if productDetails.discount_price }}
              <h4 class="price py-3 text-success">&#x20b9;{{productDetails.discount_price}}</h4>
              <h5 class="py-3 ps-2 price text-danger"><del>&#x20b9;{{productDetails.actual_price}}/-</del></h5>
              {{else}}
              <h4 class="py-3 price">&#x20b9;{{productDetails.actual_price}}/-</h4>
              {{/if}}
            </div>
            <div>
              <div class="pt-4">
                <button onclick="addToCart('{{productDetails._id}}','{{productDetails.stock}}')" id="{{productDetails._id}}" style="display: inline-block;" class="btn btn-dark rounded-0">Add to
                  cart</button>
                <a href="#" class="btn btn-outline-dark rounded-0">Add to wishlist</a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>



<section style="background-color: #eee;" class="mt-3">
  <div class="text-center container py-3 rounded-5">
    <h4 class="mt-4 mb-5 separator text-uppercase logo text-uppercase" style="color: #4a1942;"><strong>Related
        items</strong></h4>

    <div class="owl-carousel owl-theme">
      {{#each products}}
      {{#ifCond this.category ../productDetails.category}}
      <div class="item">
        <div class="mb-4">


          <div class="card h-100" style="background-color: transparent;">
            <div class="bg-image hover-zoom ripple ripple-surface ripple-surface-light" data-mdb-ripple-color="light">
              <img src="/product-images/{{this._id}}.jpg" class="w-100" style="height: 25rem;" />
              <a href="/product-details/{{this._id}}">
                {{! <div class="mask">
                  <div class="d-flex justify-content-start align-items-end h-100">
                    <h5><span class="badge bg-primary ms-2">New</span></h5>
                  </div>
                </div> }}
                <div class="hover-overlay">
                  <div class="mask" style="background-color: rgba(251, 251, 251, 0.15);"></div>
                </div>
              </a>
            </div>
            <div class="card-body">
              <a href="/product-details/{{this._id}}" class="text-start text-reset">
                <div class="d-flex justify-content-between">
                  <h5 class="card-title">{{this.name}}</h5>
                  <a href="" class="text-dark "><i class="fa-regular fa-heart "></i></a>
                </div>
              </a>
              {{!-- <a href="" class="text-start text-reset">
                <p>category</p>
              </a> --}}
              {{#if this.discount_price}}
              <h6 class="text-start"> &#x20b9;{{this.discount_price}}</h6>
              {{else}}
              <h6 class="text-start"> &#x20b9;{{this.actual_price}}</h6>
              {{/if}}


              {{!-- <a href="#" class="btn btn-outline-dark rounded-0 p-1">Add to Wishlist</a> --}}
              {{!-- <a href="/add-to-cart/{{this._id}}"> --}}
                <button onclick="addToCart('{{this._id}}')" class="cta">
                  <span class="hover-underline-animation">Add to cart</span>
                  <svg id="arrow-horizontal" xmlns="http://www.w3.org/2000/svg" width="30" height="10"
                    viewBox="0 0 46 16">
                    <path id="Path_10" data-name="Path 10"
                      d="M8,0,6.545,1.455l5.506,5.506H-30V9.039H12.052L6.545,14.545,8,16l8-8Z"
                      transform="translate(30)"></path>
                  </svg>
                </button>
                {{!-- </a> --}}

            </div>
          </div>


        </div>
      </div>
      {{/ifCond}}
      {{/each}}
    </div>

  </div>
</section>



<style>
  .pro-detail {
    width: 30rem;
    height: 35rem;
    background-color: transparent;
    box-shadow: none;
  }

  option {
    color: black;
  }

  select {
    background-color: transparent;
  }

  .stars i {
    color: gold;
  }

  .price {
    font-family: 'Lora', serif;
  }
</style>

<script>
  $(function () {
    $("#image-zoom").imagezoomsl({
      zoomrange: [4, 4]
    });
  });
</script>





{{!-- /////////////////////////////////////related products/////////////////////////////////////////////// --}}

{{!-- <section style="background-color: #eee;" class="mt-3">
  <div class="text-center container py-3 rounded-5">
    <h4 class="mt-4 mb-5 separator text-uppercase logo text-uppercase" style="color: #4a1942;"><strong>Related
        items</strong></h4>

    <div class="owl-carousel owl-theme">
      {{#each products}}
      {{#ifCond this.category ../productDetails.category}}
      <div class="item">
        <div class="mb-4">


          <div class="card h-100 p-0" style="background-color: transparent;">
            <div class="bg-image hover-zoom ripple ripple-surface ripple-surface-light" data-mdb-ripple-color="light">
              <img src="{{this.image_path.[0]}}" class="w-100" style="height: 25rem;" />
              <a href="/product-details/{{this._id}}">
                {{! <div class="mask">
                  <div class="d-flex justify-content-start align-items-end h-100">
                    <h5><span class="badge bg-primary ms-2">New</span></h5>
                  </div>
                </div> }}
                <div class="hover-overlay">
                  <div class="mask" style="background-color: rgba(251, 251, 251, 0.15);"></div>
                </div>
              </a>
            </div>
            <div class="card-body">
              <a href="/product-details/{{this._id}}" class="text-start text-reset">
                <div class="d-flex justify-content-between">
                  <h5 class="card-title">{{this.name}}</h5>
                  <a href="" class="text-dark "><i class="fa-regular fa-heart "></i></a>
                </div>
              </a>
              {{!-- <a href="" class="text-start text-reset">
                <p>category</p>
              </a> --}}
              {{#if this.discount_price}}
              <h6 class="text-start"> ₹{{this.discount_price}}</h6>
              {{else}}
              <h6 class="text-start"> ₹{{this.actual_price}}</h6>
              {{/if}}


            </div>
          </div>


        </div>
      </div>
 {{/ifCond}}
      {{/each}}
    </div>

  </div>
</section> --}}

{{!-- ////////////////////report/////////////////////// --}}

router.get("/stats", async (req, res) => {
    const today = new Date();
    const latYear = today.setFullYear(today.setFullYear() - 1);
  
    try {
      const data = await  db.get().collection('order').aggregate([
        {
            $match:{status:'Delivered'}
        },
        {
        
          $project: {
            month: { $month: "$Date" },
            total:"$totalAmount"
          },
        },
        {
          $group: {
            _id: "$month",
            total: { $sum: "$total" },
          },
        },
      ]).sort({ _id: -1 }).toArray();
      res.status(200).json(data)
      console.log(data);
    } catch (err) {
      res.status(500).json(err);
      console.log(err);
    }
  });
  
  router.get("/stats2", async (req, res) => {
    const today = new Date();
    const latYear = today.setFullYear(today.setFullYear() - 1);
  
    try {
      const data = await  db.get().collection('order').aggregate([
        {
            $match:{status:'Delivered'}
        },
        {
        
          $project: {
            week: { $week: "$Date" },
            total:"$totalAmount"
          },
        },
        {
          $group: {
            _id: "$week",
            total: { $sum: "$total" },
          },
        },
      ]).sort({ _id: -1 }).toArray();
      res.status(200).json(data)
      console.log(data);
    } catch (err) {
      res.status(500).json(err);
      console.log(err);
    }
  });
  router.get("/stats3", async (req, res) => {
    const today = new Date();
    const latYear = today.setFullYear(today.setFullYear() - 1);
  
    try {
      const data = await  db.get().collection('order').aggregate([
        {
            $match:{status:'Delivered'}
        },
        {
        
          $project: {
            dayOfMonth: { $dayOfMonth: "$Date" },
            total:"$totalAmount"
          },
        },
        {
          $group: {
            _id: "$dayOfMonth",
            total: { $sum: "$total" },
          },
        },
      ]).sort({ _id: -1 }).toArray();
      res.status(200).json(data)
      console.log(data);
    } catch (err) {
      res.status(500).json(err);
      console.log(err);
    }
  });
  
  router.get("/stats4", async (req, res) => {
    const today = new Date();
    const latYear = today.setFullYear(today.setFullYear() - 1);
  
    try {
      const data = await  db.get().collection('order').aggregate([
        {
            $match:{status:'Delivered'}
        },
        {
          $project: {
            year: { $year: "$Date" },
            total:"$totalAmount"
          },
        },
        {
          $group: {
            _id: "$year",
            total: { $sum: "$total" },
          },
        },
      ]).sort({ _id: -1 }).toArray();
      res.status(200).json(data)
      console.log(data);
    } catch (err) {
      res.status(500).json(err);
      console.log(err);
    }
  });